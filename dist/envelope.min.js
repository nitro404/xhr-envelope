!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.envelope=factory()}(this,function(){"use strict";"undefined"!=typeof require&&"undefined"==typeof utilities&&(global.utilities=require("extra-utilities"));var envelope={},validMethods=Object.freeze(["HEAD","GET","POST","PUT","PATCH","DELETE"]),defaultOptions={baseUrl:null,authorization:null,timeout:3e4};return envelope.hasBaseUrl=function(){return utilities.isNonEmptyString(defaultOptions.baseUrl)},envelope.getBaseUrl=function(){return defaultOptions.baseUrl},envelope.setBaseUrl=function(url){utilities.isEmptyString(url)||(defaultOptions.baseUrl=url)},envelope.clearBaseUrl=function(){defaultOptions.baseUrl=null},envelope.hasAuthorization=function(){return utilities.isNonEmptyString(defaultOptions.authorization)},envelope.getAuthorization=function(){return defaultOptions.authorization},envelope.setAuthorizationToken=function(token){utilities.isEmptyString(token)||(defaultOptions.authorization=token)},envelope.setBasicAuthorization=function(userName,password){utilities.isEmptyString(userName)||utilities.isEmptyString(password)||(defaultOptions.authorization="Basic "+btoa(userName+":"+password))},envelope.clearAuthorization=function(){defaultOptions.authorization=null},envelope.hasTimeout=function(){return utilities.isValid(defaultOptions.timeout)},envelope.getTimeout=function(){return defaultOptions.timeout},envelope.setTimeout=function(timeout){var formattedTimeout=utilities.parseInteger(timeout);utilities.isInvalidNumber(formattedTimeout)||formattedTimeout<1||(defaultOptions.timeout=formattedTimeout)},envelope.clearTimeout=function(){defaultOptions.timeout=null},envelope.request=function(method,path,data,query,options,callback){if(utilities.isFunction(data)?(callback=data,data=query=options=null):utilities.isFunction(query)?(callback=query,query=options=null):utilities.isFunction(options)&&(callback=options,options=null),!utilities.isFunction(callback))throw new Error("Missing or invalid callback function!");if(utilities.isEmptyString(method))return callback(new Error("Missing or invalid method type."));var formattedMethod=method.toUpperCase().trim(),isUpload="UPLOAD"===formattedMethod;isUpload&&(formattedMethod="POST");for(var validMethod=!1,i=0;i<validMethods.length;i++)if(formattedMethod===validMethods[i]){validMethod=!0;break}if(!validMethod)return callback(new Error('Invalid method type: "'+formattedMethod+'" - expected one of: '+validMethods.join(", ")+"."));var hasBody="POST"===formattedMethod||"PUT"===formattedMethod||"PATCH"===formattedMethod;utilities.isValid(data)&&!hasBody&&(options=query,query=data,data=null);var newOptions=utilities.isObject(options)?utilities.clone(options):{};newOptions.type=formattedMethod,newOptions.contentType="application/json",newOptions.dataType="json",newOptions.json=!0,null===newOptions.timeout||Number.isInteger(newOptions.timeout)||(newOptions.timeout=defaultOptions.timeout),utilities.isInvalid(newOptions.timeout)&&delete newOptions.timeout,utilities.isNonEmptyString(newOptions.baseUrl)?newOptions.url=newOptions.baseUrl:newOptions.url=utilities.isNonEmptyString(defaultOptions.baseUrl)?defaultOptions.baseUrl:"",newOptions.url+=utilities.prependSlash(path),newOptions.url+=utilities.createQueryString(query,!0),hasBody&&utilities.isValid(data)&&(newOptions.data=utilities.isObject(data)?JSON.stringify(data):data),utilities.isObject(newOptions.headers)||(newOptions.headers={}),isUpload?newOptions.headers["Content-Type"]=void 0:utilities.isEmptyString(newOptions.headers["Content-Type"])&&(newOptions.headers["Content-Type"]="application/json"),utilities.isEmptyString(newOptions.headers.Accepts)&&(newOptions.headers.Accepts="application/json"),utilities.isValid(newOptions.authorization)&&(utilities.isNonEmptyString(newOptions.authorization)&&(utilities.isNonEmptyString(newOptions.headers.Authorization)&&console.error("Authorization specified in header data is being overridden by authorization at root level of options."),newOptions.headers.Authorization=newOptions.authorization),delete newOptions.authorization),utilities.isEmptyString(newOptions.headers.Authorization)&&utilities.isNonEmptyString(defaultOptions.authorization)&&(newOptions.headers.Authorization=defaultOptions.authorization);var request=new XMLHttpRequest;if(request.open(newOptions.method,newOptions.url,!0),utilities.isObjectStrict(newOptions.headers)){var headerName=null,headerNames=Object.keys(newOptions.headers);for(i=0;i<headerNames.length;i++)headerName=headerNames[i],request.setRequestHeader(headerName,newOptions.headers[headerName])}request.setRequestHeader("Content-Type","application/json"),request.timeout=newOptions.timeout,request.addEventListener("load",function(event){if("string"!=typeof request.responseText||0===request.responseText.length)return callback(null,null,request.status);var responseJSON=null;try{responseJSON=JSON.parse(request.responseText)}catch(error){return error.message="Invalid response data: "+error.message,error.status=request.status,callback(error,null,request.status)}if(utilities.isObjectStrict(responseJSON)&&utilities.isObjectStrict(responseJSON.error)){var message=responseJSON.error.message;utilities.isEmptyString(message)&&(message="Unknown error.");for(var error=new Error(message),attributeName=null,attributeNames=Object.getOwnPropertyNames(responseJSON.error),i=0;i<attributeNames.length;i++)error[attributeName=attributeNames[i]]=responseJSON.error[attributeName];return error.status=request.status,callback(error,null,request.status)}return callback(null,responseJSON,request.status)}),request.addEventListener("error",function(event){return callback(utilities.createError("Connection failed!",0),null,0)}),utilities.isObject(newOptions)?request.send(newOptions.data):request.send()},envelope.head=function(path,data,query,options,callback){return envelope.request("HEAD",path,data,query,options,callback)},envelope.get=function(path,data,query,options,callback){return envelope.request("GET",path,data,query,options,callback)},envelope.post=function(path,data,query,options,callback){return envelope.request("POST",path,data,query,options,callback)},envelope.put=function(path,data,query,options,callback){return envelope.request("PUT",path,data,query,options,callback)},envelope.patch=function(path,data,query,options,callback){return envelope.request("PATCH",path,data,query,options,callback)},envelope.delete=function(path,data,query,options,callback){return envelope.request("DELETE",path,data,query,options,callback)},envelope.upload=function(path,data,query,options,file,callback){var fileDescriptor=new FormData;if(utilities.isValid(file)&&fileDescriptor.append("file",file),utilities.isObjectStrict(data))for(var attribute in data)"file"!==attribute&&fileDescriptor.append(attribute,data[attribute]);return envelope.request("UPLOAD",path,fileDescriptor,query,options,callback)},envelope});
//# sourceMappingURL=envelope.min.js.map
